function trackEvent(){window.usercomlib.trackEvent=function(e,t){if(!e||0==e.length)return void console.error("Usercom Error: Event name not provided !");var n={appid:this.appid,userdata:this.userData,properties:t,eventname:e,sessionId:this.sessionId,visitorId:this.visitorId};xhr.raw(DEFAULT_CONFIG.api_host+"/VisitorTrackingManager/event",JSON.stringify(n),function(e){console.log(e)})}}function createServiceWorker(e){navigator.serviceWorker.register(DEFAULT_CONFIG.serviceWorkerFile).then(function(e){return e.pushManager.getSubscription().then(function(t){return t||e.pushManager.subscribe({userVisibleOnly:!0})})}).then(function(t){fetch(DEFAULT_CONFIG.api_host+"/VisitorTrackingManager/register",{method:"post",headers:{"Content-type":"application/json"},body:JSON.stringify({sessionId:e.sessionId,endpoint:e.endpoint,p256dh:btoa(String.fromCharCode.apply(null,new Uint8Array(t.getKey("p256dh")))),auth:btoa(String.fromCharCode.apply(null,new Uint8Array(t.getKey("auth"))))})})})}var HTTP_PROTOCOL="https:"===document.location.protocol?"https://":"http://",utils={guidGenerator:function(){var e=function(){return(65536*(1+Math.random())|0).toString(16).substring(1)};return e()+e()+e()+e()+e()+e()+e()+e()},extendObj:function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);return e}},cookie={createCookie:function(e,t,n){var r="";if(n){var o=new Date;o.setTime(o.getTime()+24*n*60*60*1e3),r="; expires="+o.toUTCString()}document.cookie=e+"="+t+r+"; path=/"},readCookie:function(e){for(var t=e+"=",n=document.cookie.split(";"),r=0;r<n.length;r++){for(var o=n[r];" "==o.charAt(0);)o=o.substring(1,o.length);if(0==o.indexOf(t))return o.substring(t.length,o.length)}return null},eraseCookie:function(e){createCookie(e,"",-1)}},xhr={formdata:function(e,t,n){try{var r=new XMLHttpRequest;r.open(t?"POST":"GET",e,1),r.setRequestHeader("X-Requested-With","XMLHttpRequest"),r.setRequestHeader("Content-type","application/x-www-form-urlencoded"),r.onreadystatechange=function(){r.readyState>3&&callback&&callback(r.responseText,r)},r.send(t)}catch(e){window.console&&console.log(e)}},raw:function(e,t,n){try{var r=new XMLHttpRequest;r.open(t?"POST":"GET",e,1),r.setRequestHeader("X-Requested-With","XMLHttpRequest"),r.setRequestHeader("Content-type","application/json"),r.onreadystatechange=function(){r.readyState>3&&n&&n(r.responseText,r)},r.send(t)}catch(e){window.console&&console.log(e)}}},DEFAULT_CONFIG={api_host:"VARIABLE_BASEURL",serviceWorkerFile:"/usercom-sw.js"},SERVICES=["track","trackEvent"],Usercom={props:{sessionId:null,visitorId:null,appid:null},init:function(e){var t="VARIABLE_APPID",n=this;if(0==t.length)return void console.error("Usercom Error: Invalid app id !");window.usercomlib={},usercomlib.appid=t,usercomlib.userdata=e,n.establishSocketConnection(usercomlib),n.bindGlobalErrorHandler(usercomlib),n.props.appid=t;var r={appid:t,userdata:e,uid:utils.guidGenerator(),screenResolution:screen.width+"x"+screen.height,timezone:-(new Date).getTimezoneOffset()/60};xhr.raw(DEFAULT_CONFIG.api_host+"/VisitorTrackingManager/ping",JSON.stringify(r),function(e){console.log(e);var t=JSON.parse(e);n.props.sessionId=t.sessionId,n.props.visitorId=t.status._id,n.initServices()})},establishSocketConnection:function(e){var t=new WebSocket("ws://localhost:8001/");t.onopen=function(){var n={};n.name="establishvisitorconnection",n.key=e.userdata.email+"-"+e.appid,n=JSON.stringify(n),t.send(n)},t.onclose=function(){t.send("closing")}},bindGlobalErrorHandler:function(e){var t=window.onerror;window.onerror=function(n,r,o,i,s){t&&t.apply(this,arguments);var a=["Message: "+n,"URL: "+r,"Line: "+o,"Column: "+i,"Error object: "+JSON.stringify(s)].join(" - "),c={appid:e.appid,userdata:e.userData,errormsg:a,uid:utils.guidGenerator()};return xhr.raw(DEFAULT_CONFIG.api_host+"/VisitorTrackingManager/error",JSON.stringify(c),function(e){console.log(e)}),!1}},initServices:function(){for(var e=0;e<SERVICES.length;e++)SERVICES[e]()}};